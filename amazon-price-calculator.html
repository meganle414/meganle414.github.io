<!doctype html>
<html lang="en">
  <head>
    <meta name="viewport" charset="utf-8" content="width=device-width, initial-scale=1.0">
    <title>Home</title>
    <link rel="stylesheet" href="style.css">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Poppins:wght@500&display=swap">
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/font-awesome/4.2.0/css/font-awesome.min.css">
    <script src="bundle.js"></script>
    <!-- <script src="puppeteer_browserify.js"></script> -->
    <script src="https://unpkg.com/puppeteer-web"></script>
  </head>
  <body>
    <section class="header">
      <a name="top"></a>
      <nav>
        <a href="index.html"><img class="circle-image" src="images/me.jfif" height="150" width="150"></a>
        <div class="nav-links" id="navLinks">
          <i class="fa fa-times" onclick="hideMenu()" ></i>
          <ul>
            <li><a href="index.html">Home</a></li>
            <li><a href="" onclick=resume()>Resume</a></li>
            <li><a href="" onclick=github()>GitHub</a></li>
            <li><a href="amazon-price-calculator.html">Amazon Price Calculator</a></li>
            <li><a href="contact.html">Contact</a></li>
          </ul>
        </div>
        <i class="fa fa-bars" onclick="showMenu()"></i>
      </nav>
      <div class="text-box">
        <h1>Amazon Price Calculator</h1>
        <p>Paste Amazon list link here to get total item count and total price</p>
        <input type="url" id="link"><br><br><br>
        <button onclick="calculate(document.getElementById('link').value)" class="hero-btn">Calculate</button>
        <div class="item-count-container" id="item-count-container"></div>
        <div class="total-price-container" id="total-price-container"></div>
      </div>
    </section>
    <section class="body">
      
    </section>
    <script>
      function showMenu() {
        document.getElementById("navLinks").style.right = 0;
      }

      function hideMenu() {
        document.getElementById("navLinks").style.right = "-200px";
      }

      function linkedin() {
        window.open('https://www.linkedin.com/in/meganle414/','_blank')
      }

      function github() {
        window.open('https://github.com/meganle414','_blank')
      }

      function resume() {
        window.open('https://docs.google.com/document/d/1N_a0BnvtWulN9gXB9RssG_yFH-nFrh3043g6GXzb_zk/edit?usp=sharing','_blank')
      }

      
      async function calculate(url) {
        const response = await fetch('/calculate', {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify({ url }),
        });

        const result = await response.json();

        document.getElementById("item-count-container").innerHTML = `Count: ${result.itemCount}`;
        document.getElementById("total-price-container").innerHTML = `Total Price: $${result.totalPrice}`;
      }

    //   async function calculate(url) {
    //     //   const url = 'https://www.amazon.com/hz/wishlist/ls/1YWPWG9NHD4RP?ref_=wl_share';

    //     // launch the browser
    //     const browser = await puppeteer.launch();
    //     // const browser = await puppeteer.connect({
    //     //     browserWSEndpoint: `ws://0.0.0.0:8080`, // <-- connect to a server running somewhere
    //     //     ignoreHTTPSErrors: true
    //     // });
    //     const page = await browser.newPage();

    //     await page.goto(url);

    //     // initialize the array and variable for item prices
    //     let prices = [];
    //     let totalPrice = 0;

    //     // get the HTML content
    //     const html = await page.content();

    //     // parse the HTML using cheerio
    //     const $ = cheerio.load(html);

    //     $('span.a-price').each((index, element) => {
    //         const priceText = $(element).find('span').first().text().replace('$', '');
    //         prices.push(parseFloat(priceText));
    //     });

    //     totalPrice = prices.reduce((acc, current) => acc + current, 0);

    //     console.log(`Count: ${prices.length}`);
    //     console.log(`Total Price: $${totalPrice.toFixed(2)}`);

    //     document.getElementById("item-count-container").innerHTML = `Count: ${prices.length}`;
    //     document.getElementById("total-price-container").innerHTML = `Total Price: $${totalPrice.toFixed(2)}`;

    //     // close the browser
    //     await browser.close();
    //   }

    </script>
  </body>
</html>